<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Couch Customizer</title>
    <link rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="white"/>
    <link rel="icon"
          type="image/png"
          href="favicon-uqido.png">
    <meta name="description" content="">

    <script src="https://unpkg.com/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

    <script src="https://unpkg.com/intersection-observer/intersection-observer.js"></script>

    <script src="https://unpkg.com/resize-observer-polyfill/dist/ResizeObserver.js"></script>

    <script src="https://unpkg.com/fullscreen-polyfill/dist/fullscreen.polyfill.js"></script>

    <script src="https://unpkg.com/focus-visible/dist/focus-visible.js" defer></script>

</head>

<body class="fullscreen">

<div style="display: flex; flex-direction: row;height: 100%;min-height: 100%;flex-wrap: wrap">
    <model-viewer id="model-viewer" class='model-viewer-w80' ar camera-controls src='models/Vallentuna.glb'
                  ios-src='models/Vallentuna.usdz' alt='' min-field-of-view="40deg" max-field-of-view="70deg" camera-target="0m 0m 0m"
                  max-camera-orbit="auto 85.5deg 0" min-camera-orbit="auto 28.5deg 0" exposure="0.6"
                  shadow-intensity="2.5" shadow-softness="0.4"
                  quick-look-browsers="safari chrome">
        <div class="logo-bar">
            <div class="upper-left-logo uqido-logo"></div>
        </div>

        <div class="viewer-bottom">
            <div id="colorBlack" class="clickable" style="width:48px;height: 48px; background-color: black; border-radius: 50%;"></div>
            <div id="colorWhite" class="clickable" style="width:48px;height: 48px; background-color: white; border-radius: 50%;"></div>
            <div id="colorBeige" class="clickable" style="width:48px;height: 48px; background-color: beige; border-radius: 50%;"></div>
            <div id="colorGrey" class="clickable" style="width:48px;height: 48px; background-color: grey; border-radius: 50%;"></div>
            <div id="move_camera" class="clickable" style="background-image: url(img/Move.png);"></div>
        </div>
        <script src="js/LoadingBar.js"></script>
        <script>
            const modelViewer = document.getElementById('model-viewer');

            const cameraSwitch = document.getElementById('move_camera');

            const positions = ["-35deg 65deg 105%", "-90deg 65deg 105%", "180deg 65deg 105%"];
            let cameraIndex = 0;

            cameraSwitch.onclick = function () {
                cameraIndex = (++cameraIndex) % positions.length;
                modelViewer.cameraOrbit = positions[cameraIndex];
            };

            let worker=null;

            const colorBlack = document.getElementById('colorBlack');
            const colorWhite = document.getElementById('colorWhite');
            const colorBeige = document.getElementById('colorBeige');
            const colorGrey = document.getElementById('colorGrey');

            function colorToArray(color) {
                return color.replace(/[^\d,]/g, '').split(',').map(value => value/255);
            }


            colorBlack.onclick=()=>{
                if(worker==null) return;
                let color = colorToArray('rgb(10,10,10)');
                console.log(color)
                worker.postMessage({type:"change-color",payload:color})
            }
            colorWhite.onclick=()=>{
                if(worker==null) return;
                let color = colorToArray('rgb(221,221,221)');
                worker.postMessage({type:"change-color",payload:color})
            }
            colorBeige.onclick=()=>{
                if(worker==null) return;
                let color = colorToArray('rgb(209,178,125)');
                worker.postMessage({type:"change-color",payload:color})
            }
            colorGrey.onclick=()=>{
                if(worker==null) return;
                let color = colorToArray('rgb(103,101,96)');
                worker.postMessage({type:"change-color",payload:color})
            }

            modelViewer.addEventListener("worklet-created",(event)=>{
                worker=event.detail.worklet;
            })
        </script>

        <script type="experimental-scene-graph-worklet" allow="material-properties;messaging">

            console.log('Hello from the scene graph worklet!');


        let ColoredMat=null;

        self.addEventListener('model-change', () => {
            ColoredMat=model.materials.find(mat=> mat.name==="Vallentuna_Murum")?.pbrMetallicRoughness;
        });

        self.addEventListener('message', (event) => {
            /*if(event.data.type==="toggle-visibility"){
                if(ColoredMat.visible===true){
                    console.log('Become invisible');
                    ColoredMat.setVisible(false);
                }else{
                    console.log('Become visible');
                    ColoredMat.setVisible(true);
                }
            }else */if(event.data.type==="change-color"){
                console.log('Changing color to:', event.data.payload);
                ColoredMat.setBaseColorFactor(event.data.payload);
            }
        });

        </script>
    </model-viewer>
    <div class="right-description">
        <div>
            <div style="color: red; font-size: 3em;">Vallentuna</div>
            <br><br>
            <div class="text">Utilizzato nella Grecia antica e nelle zone magno-greche per conservare e versare olio
                profumato e unguenti, era impiegato dagli atleti, nelle cerimonie funebri e come segnacolo sepolcrale.
                La principale funzione del vaso, conservazione e aspersione di olio, ha determinato l'evolversi e lo
                stabilizzarsi della forma, dotata di collo stretto che limita la fuoriuscita del contenuto e orlo adatto
                ad impedirne lo spreco.
            </div>
            <br><br><br>
            <div class="call-to-action-button">SCOPRI DI PIU'</div>
        </div>
    </div>
</div>
<script type="module" src="js/model-viewer/dist/model-viewer.js"></script>
<script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

</body>

</html>
